<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sales</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dghzlcoco/image/upload/v1743229133/letter-l-cool-logo-icon-design_1122425-152_kouse3.jpg">
    <link rel="stylesheet" href="/static/css/font_style.css" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/toast.css" type="text/css" />
</head>

<body class="bg-white min-h-screen flex flex-col lg:flex-row">

    <div class="toast-container z-40 fixed top-0 right-4">
            <div id="toast" class="z-40 toast bg-white shadow-lg rounded-lg p-4">
                <div class="toast-content flex items-center">
                    <div class="toast-icon mr-2">
                        <i class="toast-icon-success fas fa-check-circle text-green-500 hidden"></i>
                        <i class="toast-icon-error fas fa-exclamation-circle text-red-500 hidden"></i>
                    </div>
                    <div class="toast-message text-gray-800">This is a toast message</div>
                </div>
                <div class="toast-progress h-1 bg-blue-500 mt-2"></div>
            </div>
        </div>
    <!-- Sidebar -->
    <aside id="sidebar"
        class="lg:block hidden w-full lg:w-64 bg-black text-white flex flex-col sticky top-0 lg:h-screen z-50 ">
        <div class="py-6 px-4 flex items-center justify-start space-x-4">
            <!-- Hamburger Menu for Small Screens inside Sidebar -->
            <button class="lg:hidden text-white" onclick="toggleSidebar()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <!-- Logo -->
            <h1 class="text-4xl font-bold tracking-wide logo-font">LAPTIX</h1>
        </div>
        <nav class="flex-1">
            <ul>
                <li class="py-3 px-4 flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path
                            d="M13 9V3h8v6zM3 13V3h8v10zm10 8V11h8v10zM3 21v-6h8v6zm2-10h4V5H5zm10 8h4v-6h-4zm0-12h4V5h-4zM5 19h4v-2H5zm4-2" />
                    </svg>
                    <a href="/admin/dashboard" class="text-base font-medium hover:text-blue-500">Dashboard</a>
                </li>
                <li class="py-3 px-4  flex items-center space-x-2">
                    <!-- All Products Button with Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512"
                        fill="currentColor">
                        <rect width="384" height="256" x="64" y="176" fill="none" stroke="currentColor"
                            stroke-linejoin="round" stroke-width="32" rx="28.87" ry="28.87" />
                        <path fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10"
                            stroke-width="32" d="M144 80h224m-256 48h288" />
                    </svg>
                    <a href="/admin/products" class="text-base font-medium  hover:text-blue-500">All Products</a>
                </li>
                <li class="py-3 px-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" class="mr-2">
                        <path fill="currentColor" fill-rule="evenodd"
                            d="M14.25 2.5a.25.25 0 0 0-.25-.25H7A2.75 2.75 0 0 0 4.25 5v14A2.75 2.75 0 0 0 7 21.75h10A2.75 2.75 0 0 0 19.75 19V9.147a.25.25 0 0 0-.25-.25H15a.75.75 0 0 1-.75-.75zm.75 9.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1 0-1.5zm0 4a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1 0-1.5z"
                            clip-rule="evenodd" />
                        <path fill="currentColor"
                            d="M15.75 2.824c0-.184.193-.301.336-.186q.182.147.323.342l3.013 4.197c.068.096-.006.22-.124.22H16a.25.25 0 0 1-.25-.25z" />
                    </svg>
                    <a href="/admin/orderlist" class="text-base font-medium hover:text-blue-500">Order List</a>
                </li>
                <li class="py-3 px-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" class="mr-2">
                        <path fill="currentColor"
                            d="M12 12.75c3.942 0 7.987 2.563 8.249 7.712a.75.75 0 0 1-.71.787c-2.08.106-11.713.171-15.077 0a.75.75 0 0 1-.711-.787C4.013 15.314 8.058 12.75 12 12.75m0-9a3.75 3.75 0 1 0 0 7.5a3.75 3.75 0 0 0 0-7.5" />
                    </svg>
                    <a href="/admin/users" class="text-base font-medium hover:text-blue-500">User Management</a>
                </li>
                <li class="py-3 px-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" class="mr-2">
                        <path fill="currentColor"
                            d="M10 3H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1M9 9H5V5h4zm11-6h-6a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1m-1 6h-4V5h4zm-9 4H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1m-1 6H5v-4h4zm8-6c-2.206 0-4 1.794-4 4s1.794 4 4 4s4-1.794 4-4s-1.794-4-4-4m0 6c-1.103 0-2-.897-2-2s.897-2 2-2s2 .897 2 2s-.897 2-2 2" />
                    </svg>
                    <a href="/admin/category" class="text-base font-medium hover:text-blue-500">Category Management</a>
                </li>
                <li class="py-3 px-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" class="mr-2">
                        <path fill="currentColor"
                            d="M14.8 8L16 9.2L9.2 16L8 14.8zM4 4h16c1.11 0 2 .89 2 2v4a2 2 0 1 0 0 4v4c0 1.11-.89 2-2 2H4a2 2 0 0 1-2-2v-4c1.11 0 2-.89 2-2a2 2 0 0 0-2-2V6a2 2 0 0 1 2-2m0 2v2.54a3.994 3.994 0 0 1 0 6.92V18h16v-2.54a3.994 3.994 0 0 1 0-6.92V6zm5.5 2c.83 0 1.5.67 1.5 1.5S10.33 11 9.5 11S8 10.33 8 9.5S8.67 8 9.5 8m5 5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5" />
                    </svg>
                    <a href="/admin/coupon" class="text-base font-medium text-white">Coupon Management</a>
                </li>
                <li class="py-3 px-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M21 6h-2V4a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2ZM5 4h12v2H5V4Zm16 16H5V8h16v12Zm-4-7a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z" />
                    </svg>
                    <a href="/admin/wallet/management" class="text-base font-medium hover:text-blue-500 pl-2">Wallet Management</a>
                </li>
                <li class="py-3 px-4 bg-blue-600 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 32 32" class="mr-2">
                        <path fill="Black"
                            d="M30 6V4h-3V2h-2v2h-1c-1.103 0-2 .898-2 2v2c0 1.103.897 2 2 2h4v2h-6v2h3v2h2v-2h1c1.103 0 2-.897 2-2v-2c0-1.102-.897-2-2-2h-4V6zm-6 14v2h2.586L23 25.586l-2.292-2.293a1 1 0 0 0-.706-.293H20a1 1 0 0 0-.706.293L14 28.586L15.414 30l4.587-4.586l2.292 2.293a1 1 0 0 0 1.414 0L28 23.414V26h2v-6zM4 30H2v-5c0-3.86 3.14-7 7-7h6c1.989 0 3.89.85 5.217 2.333l-1.49 1.334A5 5 0 0 0 15 20H9c-2.757 0-5 2.243-5 5zm8-14a7 7 0 1 0 0-14a7 7 0 0 0 0 14m0-12a5 5 0 1 1 0 10a5 5 0 0 1 0-10" />
                    </svg>
                    <a href="/sales" class="text-base font-medium text-black">Sales</a>
                </li>
                <li class="py-3 px-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" class="mr-2">
                        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                            stroke-width="1.5"
                            d="M7.05 6.462a2 2 0 0 0 2.63-1.519l.32-1.72a9 9 0 0 1 3.998 0l.322 1.72a2 2 0 0 0 2.63 1.519l1.649-.58a9 9 0 0 1 2.001 3.46l-1.33 1.14a2 2 0 0 0 0 3.037l1.33 1.139a9 9 0 0 1-2.001 3.46l-1.65-.58a2 2 0 0 0-2.63 1.519L14 20.777a9 9 0 0 1-3.998 0l-.322-1.72a2 2 0 0 0-2.63-1.519l-1.649.58a9 9 0 0 1-2.001-3.46l1.33-1.14a2 2 0 0 0 0-3.036L3.4 9.342a9 9 0 0 1 2-3.46zM12 9a3 3 0 1 1 0 6a3 3 0 0 1 0-6"
                            clip-rule="evenodd" />
                    </svg>
                    <a href="/admin/settings" class="text-base font-medium hover:text-blue-500">Settings</a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="p-4">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
            <h1 class="text-2xl sm:text-3xl font-bold text-black">Sales Dashboard</h1>
            <div class="flex mt-4 sm:mt-0 gap-4">
                <button onclick="downloadPDF()" style="background-color: #FF0000;"
                    class="text-white py-2 px-5 rounded inline-flex items-center drop-shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 15 15">
                        <path fill="#fff"
                            d="M2.5 6.5V6H2v.5zm4 0V6H6v.5zm0 4H6v.5h.5zm7-7h.5v-.207l-.146-.147zm-3-3l.354-.354L10.707 0H10.5zM2.5 7h1V6h-1zm.5 4V8.5H2V11zm0-2.5v-2H2v2zm.5-.5h-1v1h1zm.5-.5a.5.5 0 0 1-.5.5v1A1.5 1.5 0 0 0 5 7.5zM3.5 7a.5.5 0 0 1 .5.5h1A1.5 1.5 0 0 0 3.5 6zM6 6.5v4h1v-4zm.5 4.5h1v-1h-1zM9 9.5v-2H8v2zM7.5 6h-1v1h1zM9 7.5A1.5 1.5 0 0 0 7.5 6v1a.5.5 0 0 1 .5.5zM7.5 11A1.5 1.5 0 0 0 9 9.5H8a.5.5 0 0 1-.5.5zM10 6v5h1V6zm.5 1H13V6h-2.5zm0 2H12V8h-1.5zM2 5V1.5H1V5zm11-1.5V5h1V3.5zM2.5 1h8V0h-8zm7.646-.146l3 3l.708-.708l-3-3zM2 1.5a.5.5 0 0 1 .5-.5V0A1.5 1.5 0 0 0 1 1.5zM1 12v1.5h1V12zm1.5 3h10v-1h-10zM14 13.5V12h-1v1.5zM12.5 15a1.5 1.5 0 0 0 1.5-1.5h-1a.5.5 0 0 1-.5.5zM1 13.5A1.5 1.5 0 0 0 2.5 15v-1a.5.5 0 0 1-.5-.5z" />
                    </svg>
                    <span class="mx-2 font-bold">PDF</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="#fff"
                            d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-6 4q-.825 0-1.412-.587T4 18v-3h2v3h12v-3h2v3q0 .825-.587 1.413T18 20z" />
                    </svg>
                </button>
                <button onclick="downloadExcel()" style="background-color: #06B806;"
                    class="text-white py-2 px-4 rounded inline-flex items-center drop-shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 32 32">
                        <path fill="#fff"
                            d="M6 3v26h20V9.594l-.28-.313l-6-6l-.314-.28H6zm2 2h10v6h6v16H8zm12 1.438L22.563 9H20zM11 13v2h10v-2zm0 4v2h10v-2zm0 4v2h10v-2z" />
                    </svg>
                    <span class="mx-2 font-bold">EXCEL</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="#fff"
                            d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-6 4q-.825 0-1.412-.587T4 18v-3h2v3h12v-3h2v3q0 .825-.587 1.413T18 20z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Stats Filter Section -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Stats Filter</h3>
            <div class="flex flex-col sm:flex-row items-center justify-between">
                <div class="flex flex-wrap gap-2 mb-4 sm:mb-0">
                    <button data-period="today" onclick="filterStats('today')"
                        class="stats-button px-4 py-2 bg-indigo-100 text-indigo-800 rounded hover:bg-indigo-200 transition">Today</button>
                    <button data-period="daily" onclick="filterStats('daily')"
                        class="stats-button px-4 py-2 bg-indigo-100 text-indigo-800 rounded hover:bg-indigo-200 transition">Daily</button>
                    <button data-period="weekly" onclick="filterStats('weekly')"
                        class="stats-button px-4 py-2 bg-indigo-100 text-indigo-800 rounded hover:bg-indigo-200 transition">Weekly</button>
                    <button data-period="monthly" onclick="filterStats('monthly')"
                        class="stats-button px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">Monthly</button>
                    <button data-period="yearly" onclick="filterStats('yearly')"
                        class="stats-button px-4 py-2 bg-indigo-100 text-indigo-800 rounded hover:bg-indigo-200 transition">Yearly</button>
                </div>
                <div class="flex items-center">
                    <span class="mr-2 text-gray-700">Custom:</span>
                    <input type="date" id="stats-date-from"
                        class="border rounded p-2 mr-2 focus:outline-none focus:ring-2 focus:ring-indigo-400">
                    <span class="mx-2">to</span>
                    <input type="date" id="stats-date-to"
                        class="border rounded p-2 mr-2 focus:outline-none focus:ring-2 focus:ring-indigo-400">
                    <button onclick="filterStatsCustomDate()"
                        class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">Apply</button>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 uppercase">Total Revenue</p>
                        <h3 class="text-2xl font-bold text-gray-800"><span id="total-revenue">$0.00</span></h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                        <i class="fas fa-dollar-sign text-xl text-blue-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 uppercase">Orders</p>
                        <h3 class="text-2xl font-bold text-gray-800"><span id="order-count">0</span></h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                        <i class="fas fa-shopping-cart text-xl text-purple-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-teal-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 uppercase">Average Order</p>
                        <h3 class="text-2xl font-bold text-gray-800"><span id="average-order">$0.00</span></h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-teal-100 flex items-center justify-center">
                        <i class="fas fa-receipt text-xl text-teal-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 uppercase">Discount Applied</p>
                        <h3 class="text-2xl font-bold text-gray-800"><span id="total-discount">$0.00</span></h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                        <i class="fas fa-percent text-xl text-blue-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-violet-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 uppercase">Coupon Discount</p>
                        <h3 class="text-2xl font-bold text-gray-800"><span id="coupon-discount">$0.00</span></h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-violet-100 flex items-center justify-center">
                        <i class="fas fa-ticket text-xl text-violet-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 uppercase">Total Amount (Pre-Discount)</p>
                        <h3 class="text-2xl font-bold text-gray-800"><span id="total-amount">$0.00</span></h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                        <i class="fas fa-dollar-sign text-xl text-blue-500"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Filter Section -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Charts Filter</h3>
            <div class="flex flex-col sm:flex-row items-center justify-between">
                <div class="flex flex-wrap gap-2 mb-4 sm:mb-0">
                    <button data-period="today" onclick="filterCharts('today')"
                        class="charts-button px-4 py-2 bg-indigo-100 text-indigo-800 rounded hover:bg-indigo-200 transition">Today</button>
                    <button data-period="daily" onclick="filterCharts('daily')"
                        class="charts-button px-4 py-2 bg-indigo-100 text-indigo-800 rounded hover:bg-indigo-200 transition">Daily</button>
                    <button data-period="weekly" onclick="filterCharts('weekly')"
                        class="charts-button px-4 py-2 bg-indigo-100 text-indigo-800 rounded hover:bg-indigo-200 transition">Weekly</button>
                    <button data-period="monthly" onclick="filterCharts('monthly')"
                        class="charts-button px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">Monthly</button>
                    <button data-period="yearly" onclick="filterCharts('yearly')"
                        class="charts-button px-4 py-2 bg-indigo-100 text-indigo-800 rounded hover:bg-indigo-200 transition">Yearly</button>
                </div>
                <div class="flex items-center">
                    <span class="mr-2 text-gray-700">Custom:</span>
                    <input type="date" id="charts-date-from"
                        class="border rounded p-2 mr-2 focus:outline-none focus:ring-2 focus:ring-indigo-400">
                    <span class="mx-2">to</span>
                    <input type="date" id="charts-date-to"
                        class="border rounded p-2 mr-2 focus:outline-none focus:ring-2 focus:ring-indigo-400">
                    <button onclick="filterChartsCustomDate()"
                        class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">Apply</button>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow-md p-6 lg:col-span-2">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Sales Overview</h3>
                <canvas id="salesChart"></canvas>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Top Product Categories</h3>
                <canvas id="categoriesChart"></canvas>
            </div>
        </div>

        <!-- Recent Orders Table -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800">Recent Orders</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Order ID</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Customer</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Date</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Amount</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Status</th>
                        </tr>
                    </thead>
                    <tbody id="orders-table-body"></tbody>
                </table>
            </div>
            <div class="bg-gray-50 px-6 py-3 flex justify-between items-center">
                <div class="text-sm text-gray-700">
                    Showing <span class="font-medium">1</span> to <span class="font-medium">5</span> of <span
                        class="font-medium">56</span> results
                </div>
                <div id="pagination" class="flex items-center space-x-2"></div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script>
        let salesChart = null;
        let categoriesChart = null;
        let statsPeriod = 'monthly';
        let chartsPeriod = 'monthly';

        document.addEventListener('DOMContentLoaded', function () {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded.');
                return;
            }
            document.querySelectorAll('.stats-button').forEach(btn => {
                if (btn.getAttribute('data-period') === 'monthly') {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-800');
                    btn.classList.add('bg-indigo-600', 'text-white');
                }
            });
            document.querySelectorAll('.charts-button').forEach(btn => {
                if (btn.getAttribute('data-period') === 'monthly') {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-800');
                    btn.classList.add('bg-indigo-600', 'text-white');
                }
            });
            fetchStats('monthly');
            fetchCharts('monthly');
            fetchRecentOrders();
        });

        function fetchStats(period, fromDate = null, toDate = null) {
            let url = `/sales/filter?period=${period}&type=stats&status=Delivered`;
            if (fromDate && toDate) {
                url = `/sales/filter?period=custom&fromDate=${fromDate}&toDate=${toDate}&type=stats&status=Delivered`;
            }
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    statsPeriod = period;
                    updateDashboardStats(data);
                })
                .catch(error => console.error('Error fetching stats:', error));
        }

        function fetchCharts(period, fromDate = null, toDate = null) {
            let url = `/sales/filter?period=${period}&type=charts&status=Delivered`;
            if (fromDate && toDate) {
                url = `/sales/filter?period=custom&fromDate=${fromDate}&toDate=${toDate}&type=charts&status=Delivered`;
            }
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    chartsPeriod = period;
                    initializeSalesChart(data.salesOverview);
                    initializeCategoriesChart(data.categorySales);
                })
                .catch(error => console.error('Error fetching charts:', error));
        }

        function fetchRecentOrders(page = 1) {
            fetch(`/sales/filter?page=${page}&type=orders`)
                .then(response => response.json())
                .then(data => {
                    updateOrdersTable(data.recentOrders);
                    updatePagination(data.currentPage, data.totalPages);
                })
                .catch(error => console.error('Error fetching orders:', error));
        }

        function initializeSalesChart(salesData) {
            if (salesChart) salesChart.destroy();
            const labels = salesData.map(item => item.month);
            const revenueData = salesData.map(item => item.revenue);
            const totalAmountData = salesData.map(item => item.totalAmount);
            const ordersData = salesData.map(item => item.orders);

            const salesCtx = document.getElementById('salesChart').getContext('2d');
            salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Revenue (₹)',
                            data: revenueData,
                            borderColor: 'rgb(79, 70, 229)',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Total Amount (₹)',
                            data: totalAmountData,
                            borderColor: 'rgb(16, 185, 129)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Orders Count',
                            data: ordersData,
                            borderColor: 'rgb(249, 115, 22)',
                            backgroundColor: 'transparent',
                            borderDash: [5, 5],
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.dataset.label.includes('Revenue') || context.dataset.label.includes('Total Amount')) {
                                        label += '₹' + context.raw.toLocaleString('en-IN');
                                    } else {
                                        label += context.raw;
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: chartsPeriod === 'today' ? 'Time (4-hour intervals)' :
                                    chartsPeriod === 'daily' ? 'Date (Last 8 Days)' :
                                        chartsPeriod === 'weekly' ? 'Week' :
                                            chartsPeriod === 'monthly' ? 'Month' : 'Year'
                            },
                            ticks: {
                                autoSkip: false,
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Amount (₹)' },
                            ticks: { callback: value => '₹' + value.toLocaleString('en-IN') }
                        },
                        y1: {
                            position: 'right',
                            beginAtZero: true,
                            title: { display: true, text: 'Orders Count' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        function initializeCategoriesChart(categoryData) {
            if (categoriesChart) categoriesChart.destroy();
            const labels = categoryData.map(item => item.category);
            const values = categoryData.map(item => item.amount);

            const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
            categoriesChart = new Chart(categoriesCtx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{ data: values, backgroundColor: ['rgba(79, 70, 229, 0.8)', 'rgba(16, 185, 129, 0.8)', 'rgba(245, 158, 11, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(107, 114, 128, 0.8)'] }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ₹${value.toLocaleString('en-IN')} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        function updateDashboardStats(data) {
            document.getElementById('total-revenue').textContent = '₹' + data.totalRevenue.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('order-count').textContent = data.orderCount.toLocaleString('en-IN');
            document.getElementById('average-order').textContent = '₹' + data.averageOrder.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('total-discount').textContent = '₹' + data.discountApplied.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('coupon-discount').textContent = '₹' + data.couponDiscount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('total-amount').textContent = '₹' + data.totalAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function filterStats(period) {
            document.querySelectorAll('.stats-button').forEach(btn => {
                btn.classList.toggle('bg-indigo-600', btn.getAttribute('data-period') === period);
                btn.classList.toggle('text-white', btn.getAttribute('data-period') === period);
                btn.classList.toggle('bg-indigo-100', btn.getAttribute('data-period') !== period);
                btn.classList.toggle('text-indigo-800', btn.getAttribute('data-period') !== period);
            });
            document.getElementById('stats-date-from').value = '';
            document.getElementById('stats-date-to').value = '';
            fetchStats(period);
        }

        function filterStatsCustomDate() {
            const fromDate = document.getElementById('stats-date-from').value;
            const toDate = document.getElementById('stats-date-to').value;
            if (!fromDate || !toDate) {
                showErrorToast('Please select both dates');
                return;
            }
            if (new Date(fromDate) > new Date(toDate)) {
                showErrorToast('Start date must be before end date');
                return;
            }
            document.querySelectorAll('.stats-button').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('bg-indigo-100', 'text-indigo-800');
            });
            fetchStats('custom', fromDate, toDate);
        }

        function filterCharts(period) {
            document.querySelectorAll('.charts-button').forEach(btn => {
                btn.classList.toggle('bg-indigo-600', btn.getAttribute('data-period') === period);
                btn.classList.toggle('text-white', btn.getAttribute('data-period') === period);
                btn.classList.toggle('bg-indigo-100', btn.getAttribute('data-period') !== period);
                btn.classList.toggle('text-indigo-800', btn.getAttribute('data-period') !== period);
            });
            document.getElementById('charts-date-from').value = '';
            document.getElementById('charts-date-to').value = '';
            fetchCharts(period);
        }

        function filterChartsCustomDate() {
            const fromDate = document.getElementById('charts-date-from').value;
            const toDate = document.getElementById('charts-date-to').value;
            if (!fromDate || !toDate) {
                showErrorToast('Please select both dates');
                return;
            }
            if (new Date(fromDate) > new Date(toDate)) {
                showErrorToast('Start date must be before end date');
                return;
            }
            document.querySelectorAll('.charts-button').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('bg-indigo-100', 'text-indigo-800');
            });
            fetchCharts('custom', fromDate, toDate);
        }

        function updateOrdersTable(orders) {
            const tableBody = document.getElementById('orders-table-body');
            tableBody.innerHTML = '';
            if (!orders || orders.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No orders found</td></tr>`;
                return;
            }
            orders.forEach(order => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${order.orderID}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${order.customer}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${formatDate(order.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">₹${order.amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(order.status)}">${order.status}</span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return isNaN(date.getTime()) ? dateString : date.toLocaleDateString();
        }

        function getStatusColor(status) {
            switch (status.toLowerCase()) {
                case 'completed': return 'bg-green-100 text-green-800';
                case 'processing': return 'bg-blue-100 text-blue-800';
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'cancelled': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function downloadExcel() {
            const statsParams = getStatsFilterParams();
            window.location.href = `/sales/download/report?format=excel&${statsParams}&status=Delivered`;
        }

        function downloadPDF() {
            const statsParams = getStatsFilterParams();
            window.location.href = `/sales/download/report?format=pdf&${statsParams}&status=Delivered`;
        }

        function getStatsFilterParams() {
            const fromDate = document.getElementById('stats-date-from').value;
            const toDate = document.getElementById('stats-date-to').value;
            if (fromDate && toDate) {
                return `fromDate=${fromDate}&toDate=${toDate}`;
            }
            let period = statsPeriod;
            document.querySelectorAll('.stats-button').forEach(btn => {
                if (btn.classList.contains('bg-indigo-600')) {
                    period = btn.getAttribute('data-period');
                }
            });
            return `period=${period}`;
        }

        function changePage(page) {
            fetchRecentOrders(page);
        }

        function updatePagination(currentPage, totalPages) {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            const prevButton = document.createElement('button');
            prevButton.className = 'px-3 py-1 rounded border border-gray-300 text-gray-500 hover:bg-gray-100';
            prevButton.textContent = 'Previous';
            prevButton.disabled = currentPage <= 1;
            prevButton.onclick = () => changePage(currentPage - 1);
            paginationContainer.appendChild(prevButton);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = i === currentPage ? 'px-3 py-1 rounded bg-indigo-600 text-white hover:bg-indigo-700' : 'px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100';
                pageButton.textContent = i;
                pageButton.onclick = () => changePage(i);
                paginationContainer.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.className = 'px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100';
            nextButton.textContent = 'Next';
            nextButton.disabled = currentPage >= totalPages;
            nextButton.onclick = () => changePage(currentPage + 1);
            paginationContainer.appendChild(nextButton);
        }
    </script>
    <script src="/static/js/toastMain.js"></script>
    <script src="/static/js/nav&sideBar.js" defer></script>
</body>

</html>